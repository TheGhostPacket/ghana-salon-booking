<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Ghana Salon</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#FF6B35">
</head>
<body>
    <!-- Header -->
    <header class="header modern-header">
        <div class="container">
            <div class="logo">
                <span class="logo-icon">‚úÇÔ∏è</span>
                <h1>Ghana Salon</h1>
            </div>
            <nav class="nav-menu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="booking.html" class="nav-link">Book Now</a>
                <a href="profile.html" class="nav-link active">My Profile</a>
                <a href="admin.html" class="nav-link">Admin</a>
                <select id="languageSelector" class="language-selector">
                    <option value="en">üá¨üáß English</option>
                    <option value="tw">üá¨üá≠ Twi</option>
                    <option value="ga">üá¨üá≠ Ga</option>
                    <option value="ee">üá¨üá≠ Ewe</option>
                </select>
            </nav>
            <button class="mobile-menu-toggle">
                <span></span><span></span><span></span>
            </button>
        </div>
    </header>

    <!-- Profile Login Section -->
    <section id="loginSection" class="profile-login-section">
        <div class="container">
            <div class="login-card">
                <div class="login-image">
                    <img src="https://images.pexels.com/photos/3992870/pexels-photo-3992870.jpeg?auto=compress&cs=tinysrgb&w=400&h=500" 
                         alt="Profile login"
                         onerror="this.src='https://via.placeholder.com/400x500/FF6B35/FFFFFF?text=My+Profile'">
                </div>
                <div class="login-form-container">
                    <div class="login-header">
                        <h2>Welcome Back! üëã</h2>
                        <p>Enter your phone number to view bookings and rewards</p>
                    </div>

                    <form id="profileLoginForm" class="profile-login-form">
                        <div class="form-group">
                            <label for="loginPhone">Phone Number</label>
                            <input type="tel" id="loginPhone" placeholder="+233 XX XXX XXXX" required>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block btn-large">
                            View My Profile üöÄ
                        </button>
                    </form>

                    <div class="login-footer">
                        <p>New here? <a href="booking.html">Make your first booking</a></p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Dashboard Section -->
    <section id="profileSection" class="modern-profile-section" style="display: none;">
        <div class="container">
            <!-- Profile Header -->
            <div class="modern-profile-header">
                <div class="profile-info-section">
                    <div class="profile-avatar" id="profileAvatar">K</div>
                    <div class="profile-details">
                        <h2 id="profileName">Kwame Mensah</h2>
                        <p class="profile-phone" id="profilePhone">+233 XX XXX XXXX</p>
                        <span class="profile-badge">‚≠ê Gold Member</span>
                    </div>
                </div>
                <button onclick="logout()" class="btn btn-secondary">Logout</button>
            </div>

            <!-- Loyalty Card -->
            <div class="modern-loyalty-card">
                <div class="loyalty-header">
                    <h3>üéÅ Loyalty Rewards</h3>
                    <span class="loyalty-level">Gold Tier</span>
                </div>

                <div class="points-display">
                    <span class="points-number" id="totalPoints">250</span>
                    <span class="points-label">points</span>
                </div>

                <div class="loyalty-progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 50%"></div>
                </div>
                <p class="loyalty-text"><span id="pointsToReward">100</span> points to next reward üéâ</p>

                <div class="rewards-tiers">
                    <div class="tier active">
                        <span class="tier-icon">ü•â</span>
                        <strong>Bronze</strong>
                        <small>0-100 pts</small>
                    </div>
                    <div class="tier active">
                        <span class="tier-icon">ü•à</span>
                        <strong>Silver</strong>
                        <small>100-250 pts</small>
                    </div>
                    <div class="tier active">
                        <span class="tier-icon">ü•á</span>
                        <strong>Gold</strong>
                        <small>250+ pts</small>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="profile-stats-grid">
                <div class="profile-stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-content">
                        <h4>Total Bookings</h4>
                        <span class="stat-value" id="totalBookings">0</span>
                    </div>
                </div>

                <div class="profile-stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-content">
                        <h4>Total Spent</h4>
                        <span class="stat-value" id="totalSpent">GHS 0</span>
                    </div>
                </div>

                <div class="profile-stat-card">
                    <div class="stat-icon">üíá</div>
                    <div class="stat-content">
                        <h4>Favorite Service</h4>
                        <span class="stat-value" id="favoriteService">-</span>
                    </div>
                </div>
            </div>

            <!-- Available Rewards -->
            <div class="booking-history-section">
                <h3>üéÅ Available Rewards</h3>
                <div class="rewards-grid">
                    <div class="reward-card">
                        <div class="reward-icon">üéüÔ∏è</div>
                        <h4>10% Off Next Booking</h4>
                        <p>Use 100 points</p>
                        <button class="btn btn-primary btn-small" onclick="redeemReward(100)">
                            Redeem
                        </button>
                    </div>

                    <div class="reward-card">
                        <div class="reward-icon">üéÅ</div>
                        <h4>Free Service</h4>
                        <p>Up to GHS 50 ‚Ä¢ 200 points</p>
                        <button class="btn btn-primary btn-small" onclick="redeemReward(200)">
                            Redeem
                        </button>
                    </div>

                    <div class="reward-card">
                        <div class="reward-icon">üëë</div>
                        <h4>VIP Treatment</h4>
                        <p>Priority booking ‚Ä¢ 300 points</p>
                        <button class="btn btn-primary btn-small" onclick="redeemReward(300)">
                            Redeem
                        </button>
                    </div>
                </div>
            </div>

            <!-- Booking History -->
            <div class="booking-history-section">
                <div class="history-header">
                    <h3>üìã Booking History</h3>
                    <div class="history-tabs">
                        <button class="tab-btn active" data-filter="all">All</button>
                        <button class="tab-btn" data-filter="upcoming">Upcoming</button>
                        <button class="tab-btn" data-filter="past">Past</button>
                    </div>
                </div>

                <div class="history-list" id="bookingHistory">
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <h4>No bookings yet</h4>
                        <p>Start by making your first appointment</p>
                        <a href="booking.html" class="btn btn-primary">Book Now</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2026 Ghana Salon Booking. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="translations.js"></script>
    <script>
        document.getElementById('profileLoginForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const phone = document.getElementById('loginPhone').value;

            if (phone) {
                sessionStorage.setItem('userPhone', phone);
                showProfile(phone);
            }
        });

        function showProfile(phone) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('profileSection').style.display = 'block';
            loadProfileData(phone);
        }

        function loadProfileData(phone) {
            const allBookings = [];
            ['barber', 'salon'].forEach(businessId => {
                const appointments = getAppointments(businessId);
                const userBookings = appointments.filter(apt => apt.customerPhone === phone);
                allBookings.push(...userBookings);
            });

            const totalSpent = allBookings.reduce((sum, booking) => sum + (booking.servicePrice || 0), 0);
            const totalPoints = Math.floor(totalSpent / 10);

            document.getElementById('profilePhone').textContent = phone;
            const name = allBookings[0]?.customerName || 'Valued Customer';
            document.getElementById('profileName').textContent = name;
            document.getElementById('profileAvatar').textContent = name.charAt(0).toUpperCase();

            document.getElementById('totalBookings').textContent = allBookings.length;
            document.getElementById('totalSpent').textContent = `GHS ${totalSpent}`;
            document.getElementById('totalPoints').textContent = totalPoints;

            const nextReward = Math.ceil(totalPoints / 100) * 100;
            const pointsNeeded = nextReward - totalPoints;
            document.getElementById('pointsToReward').textContent = pointsNeeded;

            const progress = (totalPoints % 100);
            document.getElementById('progressFill').style.width = progress + '%';

            if (allBookings.length > 0) {
                const serviceCount = {};
                allBookings.forEach(booking => {
                    serviceCount[booking.service] = (serviceCount[booking.service] || 0) + 1;
                });
                const favorite = Object.keys(serviceCount).reduce((a, b) => 
                    serviceCount[a] > serviceCount[b] ? a : b
                );
                document.getElementById('favoriteService').textContent = favorite;
            }

            displayBookingHistory(allBookings);
        }

        function displayBookingHistory(bookings) {
            const historyContainer = document.getElementById('bookingHistory');

            if (bookings.length === 0) {
                historyContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <h4>No bookings yet</h4>
                        <p>Start by making your first appointment</p>
                        <a href="booking.html" class="btn btn-primary">Book Now</a>
                    </div>
                `;
                return;
            }

            bookings.sort((a, b) => new Date(b.date) - new Date(a.date));

            historyContainer.innerHTML = bookings.map(booking => `
                <div class="booking-card">
                    <div class="booking-card-header">
                        <div>
                            <h4>${booking.service}</h4>
                            <p class="booking-business">${booking.businessId === 'barber' ? "Kofi's Classic Cuts" : "Ama's Beauty Haven"}</p>
                        </div>
                        <span class="booking-status ${new Date(booking.date) > new Date() ? 'upcoming' : 'completed'}">
                            ${new Date(booking.date) > new Date() ? 'üîú Upcoming' : '‚úÖ Completed'}
                        </span>
                    </div>
                    <div class="booking-card-details">
                        <div class="detail-item">
                            <span class="detail-icon">üìÖ</span>
                            <span>${formatDate(booking.date)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-icon">üïê</span>
                            <span>${booking.time}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-icon">üí∞</span>
                            <span>GHS ${booking.servicePrice}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-icon">üéÅ</span>
                            <span>${Math.floor(booking.servicePrice / 10)} points earned</span>
                        </div>
                    </div>
                    ${new Date(booking.date) > new Date() ? `
                        <div class="booking-card-actions">
                            <button class="btn btn-secondary btn-small" onclick="rescheduleBooking(${booking.id})">
                                Reschedule
                            </button>
                            <button class="btn btn-danger btn-small" onclick="cancelBooking('${booking.businessId}', ${booking.id})">
                                Cancel
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-GB', { 
                day: 'numeric', 
                month: 'short', 
                year: 'numeric' 
            });
        }

        function redeemReward(points) {
            const totalPoints = parseInt(document.getElementById('totalPoints').textContent);
            if (totalPoints >= points) {
                if (confirm(`Redeem this reward for ${points} points?`)) {
                    alert('üéâ Reward redeemed successfully!');
                    const newPoints = totalPoints - points;
                    document.getElementById('totalPoints').textContent = newPoints;
                }
            } else {
                alert(`You need ${points - totalPoints} more points to redeem this reward.`);
            }
        }

        function cancelBooking(businessId, bookingId) {
            if (confirm('Are you sure you want to cancel this booking?')) {
                deleteAppointment(businessId, bookingId);
                const phone = sessionStorage.getItem('userPhone');
                loadProfileData(phone);
                alert('Booking cancelled successfully');
            }
        }

        function rescheduleBooking(bookingId) {
            alert('Rescheduling feature coming soon!');
        }

        function logout() {
            sessionStorage.removeItem('userPhone');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('profileSection').style.display = 'none';
            document.getElementById('loginPhone').value = '';
        }

        const savedPhone = sessionStorage.getItem('userPhone');
        if (savedPhone) {
            showProfile(savedPhone);
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;
                const phone = sessionStorage.getItem('userPhone');

                const allBookings = [];
                ['barber', 'salon'].forEach(businessId => {
                    const appointments = getAppointments(businessId);
                    const userBookings = appointments.filter(apt => apt.customerPhone === phone);
                    allBookings.push(...userBookings);
                });

                let filteredBookings = allBookings;
                const now = new Date();

                if (filter === 'upcoming') {
                    filteredBookings = allBookings.filter(b => new Date(b.date) > now);
                } else if (filter === 'past') {
                    filteredBookings = allBookings.filter(b => new Date(b.date) <= now);
                }

                displayBookingHistory(filteredBookings);
            });
        });
    </script>
</body>
</html>