<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Ghana Salon</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#FF6B35">
</head>
<body>
    <!-- Header -->
    <header class="header modern-header">
        <div class="container">
            <div class="logo">
                <span class="logo-icon">‚úÇÔ∏è</span>
                <h1>Ghana Salon - Admin</h1>
            </div>
            <nav class="nav-menu" id="adminNav" style="display: none;">
                <a href="index.html" class="nav-link">Home</a>
                <span class="nav-link" id="businessName"></span>
                <button onclick="adminLogout()" class="btn btn-danger btn-small">Logout</button>
            </nav>
        </div>
    </header>

    <!-- Admin Login Section -->
    <section id="loginSection" class="admin-login-section">
        <div class="container">
            <div class="admin-login-card">
                <div class="login-illustration">
                    <img src="https://images.unsplash.com/photo-1507679799987-c73779587ccf?w=500&h=600&fit=crop" alt="Admin login">
                </div>
                <div class="login-form-area">
                    <div class="login-header">
                        <h2>üîê Admin Login</h2>
                        <p>Please select your business to view appointments</p>
                    </div>

                    <form id="loginForm" class="admin-login-form">
                        <div class="form-group">
                            <label for="businessSelect">Select Your Business</label>
                            <select id="businessSelect" required>
                                <option value="">Choose your business...</option>
                                <option value="barber">‚úÇÔ∏è Kofi's Classic Cuts (Barbershop)</option>
                                <option value="salon">üíá Ama's Beauty Haven (Hair Salon)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="adminPassword">Password</label>
                            <input type="password" id="adminPassword" required placeholder="Enter your password">
                            <small class="demo-note">Demo password: <strong>admin123</strong></small>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block btn-large">
                            Login to Dashboard üöÄ
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Dashboard Section -->
    <section id="dashboardSection" class="admin-dashboard-section" style="display: none;">
        <div class="container">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div>
                    <h2>Dashboard Overview</h2>
                    <p id="businessLocation">Welcome back!</p>
                </div>
                <div class="dashboard-actions">
                    <button onclick="loadDashboard()" class="btn btn-secondary">
                        üîÑ Refresh
                    </button>
                    <button onclick="clearAllAppointments()" class="btn btn-danger">
                        üóëÔ∏è Clear All
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="admin-stats-grid">
                <div class="stat-card primary-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-details">
                        <h4>Total Bookings</h4>
                        <div class="stat-number" id="totalBookings">0</div>
                        <span class="stat-trend positive">+12% this week</span>
                    </div>
                </div>

                <div class="stat-card success-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-details">
                        <h4>Today's Bookings</h4>
                        <div class="stat-number" id="todayBookings">0</div>
                        <span class="stat-trend">+5 today</span>
                    </div>
                </div>

                <div class="stat-card warning-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-details">
                        <h4>Total Revenue</h4>
                        <div class="stat-number" id="totalRevenue">GHS 0</div>
                        <span class="stat-trend positive">+18% this month</span>
                    </div>
                </div>

                <div class="stat-card info-card">
                    <div class="stat-icon">üîú</div>
                    <div class="stat-details">
                        <h4>Upcoming</h4>
                        <div class="stat-number" id="upcomingCount">0</div>
                        <span class="stat-trend">Next 7 days</span>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üìà Popular Services</h3>
                    <div id="servicesChart" class="chart-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <div class="chart-card">
                    <h3>‚è∞ Peak Hours</h3>
                    <div id="peakHoursChart" class="chart-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Quick Insights -->
            <div class="insights-grid">
                <div class="insight-card">
                    <h4>üë• Customer Insights</h4>
                    <div class="insight-stats">
                        <div class="insight-item">
                            <strong id="newCustomers">0</strong>
                            <span>New Customers</span>
                        </div>
                        <div class="insight-item">
                            <strong id="returningCustomers">0</strong>
                            <span>Returning</span>
                        </div>
                        <div class="insight-item">
                            <strong id="retentionRate">0%</strong>
                            <span>Retention Rate</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Appointments Table -->
            <div class="appointments-table-section">
                <div class="table-header">
                    <h3>üìã Recent Appointments</h3>
                    <div class="table-filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="today">Today</button>
                        <button class="filter-btn" data-filter="upcoming">Upcoming</button>
                        <button class="filter-btn" data-filter="past">Past</button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Customer</th>
                                <th>Phone</th>
                                <th>Service</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="appointmentsTableBody">
                            <tr>
                                <td colspan="8" class="empty-table">
                                    <div class="empty-state">
                                        <div class="empty-icon">üì≠</div>
                                        <p>No appointments yet</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2026 Ghana Salon Booking - Admin Dashboard. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        function adminLogout() {
            sessionStorage.removeItem('currentBusiness');
            sessionStorage.removeItem('adminLoggedIn');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('adminNav').style.display = 'none';
        }

        // Chart rendering functions
        function renderServicesChart(appointments) {
            const serviceCount = {};
            appointments.forEach(apt => {
                serviceCount[apt.service] = (serviceCount[apt.service] || 0) + 1;
            });

            const chartHTML = Object.entries(serviceCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([service, count]) => {
                    const percentage = (count / appointments.length) * 100;
                    return `
                        <div class="chart-bar-item">
                            <span class="chart-label">${service}</span>
                            <div class="chart-bar">
                                <div class="chart-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                            <span class="chart-value">${count}</span>
                        </div>
                    `;
                })
                .join('');

            document.getElementById('servicesChart').innerHTML = chartHTML || '<p class="empty-chart">No data yet</p>';
        }

        function renderPeakHoursChart(appointments) {
            const hourCount = {};
            appointments.forEach(apt => {
                const hour = apt.time.split(':')[0];
                hourCount[hour] = (hourCount[hour] || 0) + 1;
            });

            const maxCount = Math.max(...Object.values(hourCount), 1);
            const chartHTML = Object.entries(hourCount)
                .sort((a, b) => parseInt(a[0]) - parseInt(b[0]))
                .map(([hour, count]) => {
                    const percentage = (count / maxCount) * 100;
                    return `
                        <div class="chart-bar-item">
                            <span class="chart-label">${hour}:00</span>
                            <div class="chart-bar">
                                <div class="chart-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                            <span class="chart-value">${count}</span>
                        </div>
                    `;
                })
                .join('');

            document.getElementById('peakHoursChart').innerHTML = chartHTML || '<p class="empty-chart">No data yet</p>';
        }

        // Enhanced loadDashboard function
        function loadDashboard() {
            const businessId = sessionStorage.getItem('currentBusiness');
            if (!businessId) return;

            const business = businesses[businessId];
            const appointments = getAppointments(businessId);

            // Update business info
            document.getElementById('businessName').textContent = business.name;
            document.getElementById('businessLocation').textContent = `üìç ${business.location}`;

            // Calculate stats
            const today = new Date().toISOString().split('T')[0];
            const todayAppointments = appointments.filter(apt => apt.date === today);
            const upcomingAppointments = appointments.filter(apt => apt.date >= today);
            const totalRevenue = appointments.reduce((sum, apt) => sum + apt.servicePrice, 0);

            // Update stat cards
            document.getElementById('totalBookings').textContent = appointments.length;
            document.getElementById('todayBookings').textContent = todayAppointments.length;
            document.getElementById('totalRevenue').textContent = `GHS ${totalRevenue}`;
            document.getElementById('upcomingCount').textContent = upcomingAppointments.length;

            // Calculate customer insights
            const uniquePhones = new Set(appointments.map(apt => apt.customerPhone));
            const phoneCount = {};
            appointments.forEach(apt => {
                phoneCount[apt.customerPhone] = (phoneCount[apt.customerPhone] || 0) + 1;
            });
            const returning = Object.values(phoneCount).filter(count => count > 1).length;
            const newCustomers = uniquePhones.size - returning;
            const retentionRate = uniquePhones.size > 0 ? Math.round((returning / uniquePhones.size) * 100) : 0;

            document.getElementById('newCustomers').textContent = newCustomers;
            document.getElementById('returningCustomers').textContent = returning;
            document.getElementById('retentionRate').textContent = retentionRate + '%';

            // Render charts
            if (appointments.length > 0) {
                renderServicesChart(appointments);
                renderPeakHoursChart(appointments);
            }

            // Load appointments table
            loadAppointmentsTable(appointments);
        }

        function loadAppointmentsTable(appointments) {
            const tbody = document.getElementById('appointmentsTableBody');

            if (appointments.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-table">
                            <div class="empty-state">
                                <div class="empty-icon">üì≠</div>
                                <p>No appointments yet</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            // Sort by date (newest first)
            appointments.sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time));

            tbody.innerHTML = appointments.map(apt => {
                const aptDate = new Date(apt.date);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                aptDate.setHours(0, 0, 0, 0);

                let status = 'pending';
                let statusIcon = 'üîú';
                let statusText = 'Upcoming';

                if (aptDate < today) {
                    status = 'completed';
                    statusIcon = '‚úÖ';
                    statusText = 'Completed';
                } else if (aptDate.getTime() === today.getTime()) {
                    status = 'today';
                    statusIcon = '‚≠ê';
                    statusText = 'Today';
                }

                return `
                    <tr class="appointment-row status-${status}">
                        <td>${formatDate(apt.date)}</td>
                        <td><strong>${apt.time}</strong></td>
                        <td>${apt.customerName}</td>
                        <td>${apt.customerPhone}</td>
                        <td>${apt.service}</td>
                        <td><strong>GHS ${apt.servicePrice}</strong></td>
                        <td><span class="status-badge status-${status}">${statusIcon} ${statusText}</span></td>
                        <td>
                            <button onclick="viewAppointment(${apt.id})" class="btn-icon" title="View">üëÅÔ∏è</button>
                            <button onclick="deleteAppointmentAdmin('${apt.id}')" class="btn-icon danger" title="Delete">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-GB', { 
                day: 'numeric', 
                month: 'short', 
                year: 'numeric' 
            });
        }

        function deleteAppointmentAdmin(aptId) {
            if (confirm('Are you sure you want to delete this appointment?')) {
                const businessId = sessionStorage.getItem('currentBusiness');
                deleteAppointment(businessId, parseInt(aptId));
                loadDashboard();
            }
        }

        function viewAppointment(aptId) {
            const businessId = sessionStorage.getItem('currentBusiness');
            const appointments = getAppointments(businessId);
            const apt = appointments.find(a => a.id === aptId);

            if (apt) {
                alert(`
Appointment Details:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Customer: ${apt.customerName}
Phone: ${apt.customerPhone}
Service: ${apt.service}
Date: ${formatDate(apt.date)}
Time: ${apt.time}
Price: GHS ${apt.servicePrice}
${apt.specialRequests ? `\nNotes: ${apt.specialRequests}` : ''}
                `);
            }
        }

        // Table filtering
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;
                const businessId = sessionStorage.getItem('currentBusiness');
                const allAppointments = getAppointments(businessId);

                let filtered = allAppointments;
                const today = new Date().toISOString().split('T')[0];

                if (filter === 'today') {
                    filtered = allAppointments.filter(apt => apt.date === today);
                } else if (filter === 'upcoming') {
                    filtered = allAppointments.filter(apt => apt.date >= today);
                } else if (filter === 'past') {
                    filtered = allAppointments.filter(apt => apt.date < today);
                }

                loadAppointmentsTable(filtered);
            });
        });
    </script>
</body>
</html>